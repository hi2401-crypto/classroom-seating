<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ê¸‰ ìë¦¬ í‹°ì¼“íŒ… (ì‹¤ì‹œê°„)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            text-align: center;
            color: rgba(255,255,255,0.9);
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .status-badge {
            text-align: center;
            color: #51cf66;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 1.1em;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .login-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 400px;
            margin: 100px auto;
        }

        .login-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-login {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-login:hover {
            transform: translateY(-2px);
        }

        .btn-login:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-reset {
            width: 100%;
            padding: 10px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }

        .info-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-info {
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
        }

        .seat-count {
            font-size: 1.1em;
            color: #666;
        }

        .online-count {
            font-size: 1em;
            color: #51cf66;
            font-weight: bold;
        }

        .classroom {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .teacher-desk {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 40px;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .sections-container {
            display: flex;
            gap: 30px;
            justify-content: center;
        }

        .section {
            flex: 1;
        }

        .section-title {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        .row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            justify-content: center;
        }

        .seat {
            width: 70px;
            height: 70px;
            border: 3px solid #667eea;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: white;
            transition: all 0.3s;
            position: relative;
        }

        .seat:hover:not(.taken) {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            background: #f0f4ff;
        }

        .seat.taken {
            background: #ff6b6b;
            border-color: #ff6b6b;
            cursor: not-allowed;
            color: white;
        }

        .seat.my-seat {
            background: #51cf66;
            border-color: #51cf66;
            color: white;
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(81, 207, 102, 0.5); }
            50% { box-shadow: 0 0 20px rgba(81, 207, 102, 0.8); }
        }

        .seat-number {
            font-size: 0.9em;
            font-weight: bold;
        }

        .seat-owner {
            font-size: 0.75em;
            margin-top: 3px;
        }

        .hidden {
            display: none;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid;
        }

        .legend-box.available {
            background: white;
            border-color: #667eea;
        }

        .legend-box.taken {
            background: #ff6b6b;
            border-color: #ff6b6b;
        }

        .legend-box.mine {
            background: #51cf66;
            border-color: #51cf66;
        }

        @media (max-width: 768px) {
            .sections-container {
                flex-direction: column;
            }
            
            .seat {
                width: 60px;
                height: 60px;
            }

            h1 {
                font-size: 1.8em;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div id="loginSection" class="login-section">
            <h2>ğŸ“ í•™ê¸‰ ìë¦¬ í‹°ì¼“íŒ…</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">ì‹¤ì‹œê°„ ë™ì‹œ ì ‘ì† ê°€ëŠ¥</p>
            <div class="input-group">
                <label for="studentName">ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</label>
                <input type="text" id="studentName" placeholder="í™ê¸¸ë™" autocomplete="off">
            </div>
            <button class="btn-login" id="loginBtn" onclick="login()">ì…ì¥í•˜ê¸°</button>
            <button class="btn-reset" onclick="resetAllSeats()">ğŸ”„ ëª¨ë“  ìë¦¬ ì´ˆê¸°í™” (ê´€ë¦¬ì)</button>
        </div>

        <!-- ë©”ì¸ ì„¹ì…˜ -->
        <div id="mainSection" class="hidden">
            <h1>ğŸ“ í•™ê¸‰ ìë¦¬ í‹°ì¼“íŒ…</h1>
            <div class="status-badge">ğŸŸ¢ ì‹¤ì‹œê°„ ì—°ê²°ë¨</div>
            <p class="subtitle">ì›í•˜ëŠ” ìë¦¬ë¥¼ í´ë¦­í•˜ì„¸ìš”! ë¹ ë¥¸ ì‚¬ëŒì´ ì„ì!</p>

            <div class="info-panel">
                <div class="user-info">
                    ğŸ‘¤ <span id="currentUser"></span>ë‹˜
                </div>
                <div class="seat-count">
                    ë‚¨ì€ ìë¦¬: <span id="availableSeats">35</span>/35
                </div>
                <div class="online-count">
                    ğŸ‘¥ ì ‘ì† ì¤‘: <span id="onlineCount">1</span>ëª…
                </div>
            </div>

            <div class="classroom">
                <div class="teacher-desk">
                    ğŸ“š êµíƒ ğŸ“š
                </div>

                <div class="sections-container">
                    <!-- 1ë¶„ë‹¨ (7ëª…) -->
                    <div class="section">
                        <div class="section-title">1ë¶„ë‹¨</div>
                        <div id="section1"></div>
                    </div>

                    <!-- 2ë¶„ë‹¨ (10ëª…) -->
                    <div class="section">
                        <div class="section-title">2ë¶„ë‹¨</div>
                        <div id="section2"></div>
                    </div>

                    <!-- 3ë¶„ë‹¨ (10ëª…) -->
                    <div class="section">
                        <div class="section-title">3ë¶„ë‹¨</div>
                        <div id="section3"></div>
                    </div>

                    <!-- 4ë¶„ë‹¨ (8ëª…) -->
                    <div class="section">
                        <div class="section-title">4ë¶„ë‹¨</div>
                        <div id="section4"></div>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box available"></div>
                        <span>ì„ íƒ ê°€ëŠ¥</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box taken"></div>
                        <span>ì„ íƒë¨</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box mine"></div>
                        <span>ë‚´ ìë¦¬</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue, remove, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyBKWBO6YGUD5WOGHUvD_r6IYBWs1faHRGI",
            authDomain: "classroom-seating-6aa38.firebaseapp.com",
            databaseURL: "https://classroom-seating-6aa38-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "classroom-seating-6aa38",
            storageBucket: "classroom-seating-6aa38.firebasestorage.app",
            messagingSenderId: "853071803372",
            appId: "1:853071803372:web:9124818e4364b594f346c9"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let currentStudent = '';
        let myUserId = '';

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.login = login;
        window.resetAllSeats = resetAllSeats;

        // ë¡œê·¸ì¸
        function login() {
            const nameInput = document.getElementById('studentName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            currentStudent = name;
            document.getElementById('currentUser').textContent = name;
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
            
            // ì˜¨ë¼ì¸ ì‚¬ìš©ì ì¶”ê°€
            addOnlineUser(name);
            
            // ìë¦¬ ë°ì´í„° ì‹¤ì‹œê°„ ê°ì§€
            listenToSeats();
            
            // ì˜¨ë¼ì¸ ì‚¬ìš©ì ì‹¤ì‹œê°„ ê°ì§€
            listenToOnlineUsers();
            
            initializeClassroom();
        }

        // ì˜¨ë¼ì¸ ì‚¬ìš©ì ì¶”ê°€ (ìˆ˜ì •: ì†Œìˆ˜ì  ì œê±°)
        function addOnlineUser(name) {
            // ì†Œìˆ˜ì ì´ ì—†ëŠ” ì•ˆì „í•œ ID ìƒì„±
            myUserId = 'user_' + Date.now() + '_' + Math.floor(Math.random() * 1000000);
            const userRef = ref(database, `online/${myUserId}`);
            
            set(userRef, {
                name: name,
                timestamp: Date.now()
            });

            // í˜ì´ì§€ ë‚˜ê°ˆ ë•Œ ì˜¨ë¼ì¸ ì‚¬ìš©ì ì œê±°
            window.addEventListener('beforeunload', () => {
                remove(userRef);
            });
        }

        // ì˜¨ë¼ì¸ ì‚¬ìš©ì ì‹¤ì‹œê°„ ê°ì§€
        function listenToOnlineUsers() {
            const onlineRef = ref(database, 'online');
            onValue(onlineRef, (snapshot) => {
                const data = snapshot.val();
                const count = data ? Object.keys(data).length : 0;
                document.getElementById('onlineCount').textContent = count;
                
                // 5ë¶„ ì´ìƒ ì§€ë‚œ ì‚¬ìš©ì ì œê±°
                if (data) {
                    const now = Date.now();
                    Object.keys(data).forEach(userId => {
                        if (now - data[userId].timestamp > 300000) {
                            remove(ref(database, `online/${userId}`));
                        }
                    });
                }
            });
        }

        // ìë¦¬ ë°ì´í„° ì‹¤ì‹œê°„ ê°ì§€
        function listenToSeats() {
            const seatsRef = ref(database, 'seats');
            onValue(seatsRef, (snapshot) => {
                const data = snapshot.val();
                updateClassroom(data || {});
                updateSeatCount(data || {});
            });
        }

        // êµì‹¤ ì´ˆê¸°í™”
        function initializeClassroom() {
            // 1ë¶„ë‹¨ (2ëª…ì”© 4ì¤„ = 8ëª…, í•˜ì§€ë§Œ 7ëª…ë§Œ)
            createSection('section1', 1, 4, 2, 7);
            
            // 2ë¶„ë‹¨ (2ëª…ì”© 5ì¤„ = 10ëª…)
            createSection('section2', 2, 5, 2, 10);
            
            // 3ë¶„ë‹¨ (2ëª…ì”© 5ì¤„ = 10ëª…)
            createSection('section3', 3, 5, 2, 10);
            
            // 4ë¶„ë‹¨ (2ëª…ì”© 4ì¤„ = 8ëª…)
            createSection('section4', 4, 4, 2, 8);
        }

        // ë¶„ë‹¨ë³„ ìë¦¬ ìƒì„±
        function createSection(containerId, sectionNum, rows, seatsPerRow, totalSeats) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            let seatCount = 0;
            
            for (let row = 0; row < rows; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'row';
                
                for (let col = 0; col < seatsPerRow; col++) {
                    if (seatCount >= totalSeats) break;
                    
                    seatCount++;
                    const seatId = `${sectionNum}-${row + 1}-${col + 1}`;
                    const seatDiv = createSeat(seatId, seatCount);
                    rowDiv.appendChild(seatDiv);
                }
                
                container.appendChild(rowDiv);
                if (seatCount >= totalSeats) break;
            }
        }

        // ê°œë³„ ìë¦¬ ìƒì„±
        function createSeat(seatId, displayNum) {
            const seatDiv = document.createElement('div');
            seatDiv.className = 'seat';
            seatDiv.dataset.seatId = seatId;
            seatDiv.dataset.displayNum = displayNum;
            
            const seatNumber = document.createElement('div');
            seatNumber.className = 'seat-number';
            seatNumber.textContent = displayNum;
            
            const seatOwner = document.createElement('div');
            seatOwner.className = 'seat-owner';
            
            seatDiv.appendChild(seatNumber);
            seatDiv.appendChild(seatOwner);
            
            seatDiv.onclick = () => handleSeatClick(seatId);
            
            return seatDiv;
        }

        // ìë¦¬ í´ë¦­ ì²˜ë¦¬
        async function handleSeatClick(seatId) {
            const seatRef = ref(database, `seats/${seatId}`);
            
            // í˜„ì¬ ìë¦¬ ìƒíƒœ í™•ì¸
            const snapshot = await get(seatRef);
            const currentOwner = snapshot.val();
            
            if (currentOwner && currentOwner !== currentStudent) {
                showNotification('ì´ë¯¸ ì„ íƒëœ ìë¦¬ì…ë‹ˆë‹¤! ğŸ˜¢');
                return;
            }
            
            if (currentOwner === currentStudent) {
                // ìê¸° ìë¦¬ ì·¨ì†Œ
                if (confirm('ìë¦¬ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    await remove(seatRef);
                    showNotification('ìë¦¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                return;
            }
            
            // ì´ë¯¸ ë‹¤ë¥¸ ìë¦¬ë¥¼ ì„ íƒí–ˆëŠ”ì§€ í™•ì¸
            const allSeatsSnapshot = await get(ref(database, 'seats'));
            const allSeats = allSeatsSnapshot.val() || {};
            
            const myCurrentSeat = Object.keys(allSeats).find(id => allSeats[id] === currentStudent);
            if (myCurrentSeat) {
                showNotification('ì´ë¯¸ ìë¦¬ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤! í˜„ì¬ ìë¦¬ë¥¼ ë¨¼ì € ì·¨ì†Œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ìë¦¬ ì„ íƒ
            try {
                await set(seatRef, currentStudent);
                showNotification('ìë¦¬ ì„ íƒ ì™„ë£Œ! ğŸ‰');
            } catch (error) {
                showNotification('ìë¦¬ ì„ íƒ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                console.error(error);
            }
        }

        // êµì‹¤ ì—…ë°ì´íŠ¸
        function updateClassroom(seats) {
            document.querySelectorAll('.seat').forEach(seatDiv => {
                const seatId = seatDiv.dataset.seatId;
                const owner = seats[seatId];
                const ownerElement = seatDiv.querySelector('.seat-owner');
                
                // ëª¨ë“  í´ë˜ìŠ¤ ì œê±°
                seatDiv.classList.remove('taken', 'my-seat');
                
                if (owner) {
                    ownerElement.textContent = owner;
                    if (owner === currentStudent) {
                        seatDiv.classList.add('my-seat');
                    } else {
                        seatDiv.classList.add('taken');
                    }
                } else {
                    ownerElement.textContent = '';
                }
            });
        }

        // ë‚¨ì€ ìë¦¬ ìˆ˜ ì—…ë°ì´íŠ¸
        function updateSeatCount(seats) {
            const totalSeats = 35;
            const takenSeats = Object.keys(seats).length;
            const availableSeats = totalSeats - takenSeats;
            document.getElementById('availableSeats').textContent = availableSeats;
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ëª¨ë“  ìë¦¬ ì´ˆê¸°í™” (ê´€ë¦¬ì ê¸°ëŠ¥)
        async function resetAllSeats() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ìë¦¬ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const password = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                if (password === 'admin1234') {
                    await remove(ref(database, 'seats'));
                    alert('ëª¨ë“  ìë¦¬ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                }
            }
        }
    </script>
</body>
</html>
